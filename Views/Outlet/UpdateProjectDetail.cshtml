@using LienPhatERP.ViewModels
@using LienPhatERP.Services
@inject IOutletStoreService DrugService
@model LienPhatERP.Entities.MProjectDetail
@{
    ViewData["Title"] = "UpdateProjectDetail";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
@functions{
    List<string> convert(string f)
    {
        if (!string.IsNullOrEmpty(f))
        {
            return LienPhatERP.Helper.JsonHelper.DeserializeObject<List<string>>(f);
        }
        return new List<string>();
    }
}
<link href="~/assets/vendors/base/blueimp-gallery-min.css" rel="stylesheet" />
<div class="m-content">
    <div class="row" id="app">
        <div class="col-xl-12">
            <!--Begin::Main Portlet-->
            <div class="m-portlet">
                <!--begin: Portlet Head-->
                <div class="m-portlet__head">
                    <div class="m-portlet__head-caption">
                        <div class="m-portlet__head-title">
                            <h3 class="m-portlet__head-text">
                                Thông tin dự án chi tiết
                            </h3>
                        </div>
                    </div>
                </div>
                <!--end: Portlet Head-->
                <!--begin: Form Wizard-->
                <div class="m-wizard m-wizard--1 m-wizard--success" id="m_wizard">
                    <!--begin: Message container -->
                    <div class="m-portlet__padding-x">
                        <!-- Here you can put a message or alert -->
                    </div>
                    <!--end: Message container -->
                    <!--begin: Form Wizard Head -->
                    <!--end: Form Wizard Head -->
                    <!--begin: Form Wizard Form-->
                    <div class="m-wizard__form">
                        <!--
                        1) Use m-form--label-align-left class to alight the form input lables to the right
                        2) Use m-form--state class to highlight input control borders on form validation
                        -->
                        <form class="m-form m-form--label-align-left- m-form--state-" id="m_form">
                            <!--begin: Form Body -->
                            <!--begin: Form Wizard -->
                            <div class="m-portlet__foot m-portlet__foot--fit">
                                <div class="m-form__actions m-form__actions">
                                    <div class="row">
                                        <div class="col-xl-8 offset-xl-2">
                                            <div class="m-form__section m-form__section--first">
                                                <div class="m-form__heading">
                                                    <h3 class="m-form__heading-title">
                                                        Dự án: @ViewData["1"] Khách hàng: @ViewData["2"]
                                                    </h3>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * MediGroup Code
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="DrugName" class="form-control m-input" value="@Model.MediGroupCode" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền tên nhà medigroup code
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Tên cửa hàng:
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="DrugName" class="form-control m-input" value="@Model.DrugName" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền tên cửa hàng
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Địa chỉ:
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="Address" class="form-control m-input" value="@Model.Address" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền địa chỉ
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Khu vực:
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="Area" class="form-control m-input" value="@Model.Area" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền khu vực
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Thành phố :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="Province" class="form-control m-input" value="@Model.Province" required>
                                                        @*<select class="form-control js-city" id="Province"></select>*@
                                                        <span class="m-form__help">
                                                            Vui lòng điền thành phố
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Quận :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="District" class="form-control m-input" value="@Model.District" required>
                                                        @*<select class="form-control js-distric" id="District"></select>*@
                                                        <span class="m-form__help">
                                                            Vui lòng điền quận
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Phường, xã :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="Ward" class="form-control m-input" value="@Model.Ward" required>
                                                        @*<select class="form-control js-ward" id="Ward"></select>*@
                                                        <span class="m-form__help">
                                                            Vui lòng điền phường, xã
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Nhãn hiệu :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <select class="form-control" asp-for="@Model.Label">
                                                            @foreach (var item in DrugService.GetAllDrugLabel())
                                                            {
                                                                <option value="@item.Name">@item.Name</option>
                                                            }
                                                        </select>
                                                        <span class="m-form__help">
                                                            Vui lòng điền nhãn hiệu
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Hạng mục:
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <select class="form-control" asp-for="@Model.Component">
                                                            @foreach (var item in DrugService.GetAllComponent())
                                                            {
                                                                <option value="@item.Name">@item.Name</option>
                                                            }
                                                        </select>
                                                        <span class="m-form__help">
                                                            Vui lòng điền hạng mục
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Vị trí :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="Position" class="form-control m-input" value="@Model.Position" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền vị trí
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Chiều ngang :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="number" name="Hsize" class="form-control m-input" value="@Model.Hsize" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền chiều ngang
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Chiều dọc :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="number" name="Vsize" class="form-control m-input" value="@Model.Vsize" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền chiều dọc
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Đơn vị tính :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="Unit" class="form-control m-input" value="@Model.Unit" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền đơn vị tính
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Chi phí nhà thuốc :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="CostPayForDrugStore" class="form-control m-input numeric" value="@Model.CostPayForDrugStore" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền chi phí nhà thuốc
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Chi phí sản xuất :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="CostPayForProduction" class="form-control m-input numeric" value="@Model.CostPayForProduction" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền chi phí sản xuất
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Ngày thuê :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="date" name="DateBeginRent" class="form-control m-input" value="@Model.DateBeginRent.ToString("yyyy-MM-dd")" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền ngày thuê
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Thời gian thuê :
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="MonthRent" class="form-control m-input" value="@Model.MonthRent" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền thời gian thuê
                                                        </span>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Image
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <a href="#" onclick="imageshow('@Model.Images')">Xem hình</a>
                                                    </div>

                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label for="example-text-input" class="col-3 col-form-label">
                                                        * Upload file :
                                                    </label>
                                                    <div class="col-lg-6">
                                                        <div class="custom-file">
                                                            <input type="file" id="filecontract" class="custom-file-input">
                                                            <label class="custom-file-label" for="customFile">
                                                                Chọn file
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-2 m--padding-left-5">
                                                        <a class="btn btn-outline-info active btnUploadVideo" id="btnUpload"><span>Upload</span></a>
                                                    </div>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Ghi chú:
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="Note" class="form-control m-input" value="@Model.Note" required>
                                                        <span class="m-form__help">
                                                            Vui lòng điền ghi chú
                                                        </span>
                                                    </div>

                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <!--end: Form Wizard Step 2-->
                                <!--end: Form Body -->
                            </div>
                            <!--begin: Form Actions -->
                            <div class="m-portlet__foot m-portlet__foot--fit">
                                <div class="m-form__actions m-form__actions">
                                    <div class="row">
                                        <div class="col-lg-2"></div>
                                        <div class="col-lg-4 m--align-right">
                                            <a href="#" class="btn btn-warning m-btn m-btn--custom m-btn--icon" id="butSubmitProjectDetail">
                                                <span>
                                                    <span>
                                                        Submit
                                                    </span>
                                                    &nbsp;&nbsp;
                                                    <i class="la la-arrow-right"></i>
                                                </span>
                                            </a>
                                        </div>
                                        <div class="col-lg-2"></div>
                                    </div>
                                </div>
                            </div>
                            <!--end: Form Actions -->
                        </form>

                    </div>
                    <!--end: Form Wizard Form-->
                </div>
                <!--end: Form Wizard-->
            </div>
            <!--End::Main Portlet-->
        </div>

    </div>
</div>
<div class="modal fade" id="result-log" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="log__images">
            </div>
        </div>
    </div>
</div>
<div id="blueimp-image-carousel" class="blueimp-gallery">
    <div class="slides"></div>
    <h3 class="title"></h3>
    <a class="prev">‹</a>
    <a class="next">›</a>
    <a class="close">×</a>
    <a class="play-pause"></a>
    <ol class="indicator"></ol>
</div>
<div id="img">
</div>
@section Scripts {
    <script src="~/assets/js/gallery.js"></script>
    <script src="~/assets/js/image.js"></script>
    <script>
        @*var citySelect = $(".js-city");
        var districtSelect = $(".js-distric");
        var wardSelect = $(".js-ward");
        $.ajax({
            url: '/Outlet/DrugProvince',
            type: 'GET',
            contentType: false,
            processData: false,
            success: function (response) {
                if (response != null) {
                    var arrayLocationFormatSelect2 =  response;

            var districtOptions = arrayLocationFormatSelect2[0].districts; // current distric value
            var wardOptions = districtOptions[0].wards; // current ward value


            citySelect.select2({
                data: arrayLocationFormatSelect2
            });

            districtSelect.select2({
                data: districtOptions
            });

            wardSelect.select2({
                data: wardOptions
            })

            // Methods
            // cityChange
            function cityChange(elEvent) {
                var cityValue = citySelect.val();

                arrayLocationFormatSelect2.forEach(function (city) {
                    if (city.id == cityValue) {
                        districtOptions = city.districts;
                    }
                })

                districtSelect.find("option").remove();
                districtOptions.forEach(function (district) {
                    var option = new Option(district.text, district.id);

                    districtSelect.append(option);
                })
            }
            // districChange
            function districChange(elEvent) {
                var districtValue = districtSelect.val();

                districtOptions.forEach(function (distric, index) {

                    if (distric.id == districtValue) {
                        wardOptions = distric.wards;
                    }
                })

                wardSelect.find("option").remove();
                wardOptions.forEach(function (ward) {
                    var option = new Option(ward.text, ward.id);

                    wardSelect.append(option);
                })

                };
                    //AddEventListenser
                    citySelect.on("change", function () {
                        cityChange();
                        districChange();
                });
                    districtSelect.on("change", function () {
                        districChange();
                });
                citySelect.val("@Model.Province").trigger('change');
                districtSelect.val("@Model.District").trigger('change');
                 wardSelect.val("@Model.Ward").trigger('change');

                }
            }
            });*@
    var uploadFile;
    function f(d) {
        uploadFile= d;
    }
    $("#btnUpload").click(function () {

        var data = new FormData();
        var uploadFile = $("#filecontract")[0].files;
        if (uploadFile.length <= 0) {
            return;
        }
        for (var x = 0; x < uploadFile.length; x++) {
            //if (uploadFile[x].name.match(/\.(jpg|jpeg|png|gif)$/)) {
            //    return;
            //}
            data.append("files", uploadFile[x]);
        }

        $.ajax({
            type: "POST",
            url: "/Outlet/UploadFile",
            contentType: false,
            processData: false,
            data: data,
            success: function (respone) {
                if (respone != null) {
                    if (respone.Data != '') {
                        f(respone.data);
                        swal("Upload", "Thành công", "success");
                    }
                }

            },
            error: function () {
                swal("Upload", "Lỗi file", "error");

            }

        });
    });
        $(document).ready(function () {
            function ajaxSubmitUpdate(event) {
                event.preventDefault();
                $("#butSubmitProjectDetail").addClass("m-loader m-loader--light m-loader--right disable");
                var formData = new FormData($('#m_form')[0]);
                formData.append("Images", uploadFile);
                //formData.append("Province", $("#Province option:selected").text());
                //formData.append("District", $("#District option:selected").text());
                //formData.append("Ward", $("#Ward option:selected").text());
                formData.append("ProjectId", @Model.ProjectId);
                formData.append("Id", @Model.Id);
                $.ajax({
                    url: '/Outlet/UpdateProjectDetail/',
                    type: 'POST',
                    data: formData, // serializes the form's elements.
                    contentType: false,
                    processData: false,
                    success: function (response) {

                        if (response != null) {
                            $("#js-reason").text("");
                            $("#butSubmitProjectDetail").removeClass("m-loader m-loader--light m-loader--right disable");
                            if (!response.result) {

                                swal("", response.message, "warning");


                            } else {

                                swal("", response.message, "success");
                                setTimeout(function () {

                                    window.location.reload();

                                    //End
                                }, 5000);


                            }
                        }
                    },
                    fail: function () {
                    }
                });
            }

            $("#butSubmitProjectDetail").on("click", ajaxSubmitUpdate);
        });
    </script>
}













