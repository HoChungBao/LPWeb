
@model List<LienPhatERP.Entities.Category>
@{
    ViewData["Title"] = "NewsPost";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="m-content">
    <div class="row" id="app">
        <div class="col-xl-12">
            <!--Begin::Main Portlet-->
            <div class="m-portlet">

                <!--begin: Form Wizard-->
                <div class="m-wizard m-wizard--1 m-wizard--success" id="m_wizard">

                    <!--begin: Form Wizard Head -->
                    <!--end: Form Wizard Head -->
                    <!--begin: Form Wizard Form-->
                    <div class="m-wizard__form">
                        <!--
                        1) Use m-form--label-align-left class to alight the form input lables to the right
                        2) Use m-form--state class to highlight input control borders on form validation
                        -->
                        <form class="m-form m-form--label-align-left- m-form--state-" id="m_form">
                            <!--begin: Form Body -->
                            <!--begin: Form Wizard -->
                            <div class="m-portlet__foot m-portlet__foot--fit m--margin-top-40">
                                <div class="m-form__actions m-form__actions">
                                    <div class="row">
                                        <div class="col-xl-8 offset-xl-2">
                                            <div class="m-form__section m-form__section--first">
                                                <div class="m-form__heading">
                                                    <h3 class="m-form__heading-title">
                                                        Create News Post
                                                    </h3>
                                                </div>
                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Tiêu đề:
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="Name" class="form-control m-input" placeholder="" value="" required>
                                                    </div>

                                                </div>

                                                <div class="m-form__section">

                                                    <div class="form-group m-form__group row js-containUpload row js-ajaxUploadFileVideo">
                                                        <label class="col-xl-3 col-lg-3 col-form-label">
                                                            * Link Image
                                                        </label>
                                                        <div class="col-xl-6 col-lg-6">
                                                            <div class="custom-file row">
                                                                <input type="file" name="LinkImage" id="LinkImage" class="custom-file-input">
                                                                <label class="custom-file-label" for="customFile">
                                                                    Choose file
                                                                </label>

                                                            </div>
                                                        </div>
                                                        <div class="col-lg-2 m--padding-left-5">
                                                            <a class="btn btn-outline-info active btnUploadVideo" id="btnUploadVideo"><span>Upload</span></a>
                                                        </div>
                                                        @*<input class="btn btn-primary btnUploadVideo" type="button" value="Upload" id="btnUploadVideo" />*@
                                                    </div>
                                                    <div class="form-group m-form__group permission-doc row">
                                                        <div class="col-lg-12">
                                                            <div class="permission-doc__container"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Mô tả
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        @*<input name="ShortContent" class="form-control m-input" placeholder="">*@
                                                        @*<div id="ShortContent" class="summernote" name="ShortContent"></div>*@

<<<<<<< HEAD
                                                        <textarea class="summernote title" name="ShortContent"></textarea>
=======
                                                        <textarea class="summernote-title" name="ShortContent"></textarea>
>>>>>>> master/CSDev

                                                    </div>
                                                </div>

                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Nội dung:
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        @*<input name="FullContent" class="form-control m-input" />*@
                                                        @*<div id="FullContent" class="summernote" name="FullContent"></div>*@
<<<<<<< HEAD
                                                        <textarea class="summernote" id="summernoteContent" name="FullContent"></textarea>
=======
                                                        <textarea class="summernote-content" name="FullContent"></textarea>
>>>>>>> master/CSDev

                                                    </div>
                                                </div>

                                                <div class="form-group m-form__group row">
                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Thêm thẻ:
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="MetaKeywords" class="form-control m-input" placeholder="" value="">
                                                    </div>
                                                </div>

                                                <div class="form-group m-form__group row">
                                                    @*<label class="col-xl-3 col-lg-3 col-form-label"> Slug</label>*@
                                                    <div class="col-xl-9 col-lg-9">
                                                        <input type="text" name="Name" class="form-control m-input" hidden="" id="slugify" />
                                                    </div>
                                                </div>

                                                <div class="form-group m-form__group row">

                                                    <label class="col-xl-3 col-lg-3 col-form-label">
                                                        * Chuyên mục:
                                                    </label>
                                                    <div class="col-xl-9 col-lg-9">
                                                        <select name="CategoryId" class="selectpicker form-control m-input selectpicker .select2-container--bootstrap .select2-search--dropdown .select2-search__field" id="CategoryId" required multiple>

                                                            @foreach (var item in Model)
                                                            {
                                                                <option value="@item.Id">
                                                                    @item.Name
                                                                </option>
                                                            }
                                                        </select>
                                                    </div>
                                                </div>

                                                <div class="form-group m-form__group row">
                                                    <div class="col-xl-3 col-lg-3 col-form-label">
                                                    </div>
                                                    <div class="col-xl-9 col-lg-9 ">
                                                        <label class="m-checkbox m-checkbox--bold m-checkbox--state-success">
                                                            <input type="checkbox">
                                                            * Duyệt
                                                            <input type="checkbox" name="IsPublished" id="chkBoxIsPublished">
                                                            <span></span>
                                                        </label>
                                                        @*<div id="checkbox-value"></div>*@
                                                    </div>

                                                </div>
                                            </div>
                                        </div>

                                        <!--end: Form Wizard Step 2-->
                                        <!--end: Form Body -->
                                    </div>
                                </div>
                            </div>
                            <!--begin: Form Actions -->
                            <div class="m-portlet__foot m-portlet__foot--fit m--margin-top-40">
                                <div class="m-form__actions m-form__actions">
                                    <div class="row">
                                        <div class="col-lg-2"></div>
                                        <div class="col-lg-4 m--align-right">
                                            <button id="save" class="btn btn-primary" onclick="save()" type="button">Save</button>
                                            @*<button id="edit" class="btn btn-primary" onclick="edit()" type="button">Cancel</button>*@
                                            <div class="click2edit"></div>
                                        </div>
                                        <div class="col-lg-2"></div>
                                    </div>
                                </div>
                            </div>

                            <!--end: Form Actions -->
                        </form>
                    </div>
                    <!--end: Form Wizard Form-->
                </div>
                <!--end: Form Wizard-->
            </div>
            <!--End::Main Portlet-->
        </div>

    </div>
</div>


@section Scripts {
    <script src="~/assets/js/summernote.js" type="text/javascript"></script>
    <script src="~/assets/js/summernote-image-captionit.js"></script>
    <script src="~/assets/js/select2.min.js"></script>

    <script>

        // $('#checkbox-value').text($('#chkBoxIsPublished').val());
        //$("#chkBoxIsPublished").on('change',
        //    function (e) {
        //        if (this.checked) {
        //            $(this).attr('value', '1');
        //        } else {
        //            $(this).attr('value', '0');
        //        }
        //        //check = $(this).is(":checked") ? true : false;
        //    });

        var slug = $("input[name=Name]").val();

        $(document).ready(function () {//summernote-title
            $('.summernote-title').summernote({
                height: 200,

                width: 700
            });
            $('.summernote-content').summernote({
                popover: {
                    image: [
                        ['custom', ['captionIt']],
                        //['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],
                        ['float', ['floatLeft', 'floatRight', 'floatNone']],
                        ['remove', ['removeMedia']]
                    ]
                },
                captionIt: {
                    figureClass: '{figure-class/es}',
                    figcaptionClass: '{figcapture-class/es}',
                    captionText: 'Caption'
                },
                callbacks: {
                    onImageUpload: function (files) {
                        if (!files.length) return;
                        var file = files[0];
                        // create FileReader
                        var reader = new FileReader();
                        reader.onloadend = function () {
                            // when loaded file, img's src set datauri
                            console.log("img", $("<img>"));
                            var img = $("<img>").attr({ src: reader.result, width: "100%" }); // << Add here img attributes !
                            console.log("var img", img);
                            $('.summernote-content').summernote("insertNode", img[0]);
                        }

                        if (file) {
                            // convert fileObject to datauri
                            reader.readAsDataURL(file);
                        }
                    }
                },
                // width: 100,
                height: 200,

                width: 700
            });
        });

        $(document).ready(function () {
            var filenameVideo = '';
            //var filenameUpload = '';
            $('.btnUploadVideo').on('click', function () {

                var data = new FormData();
                var parent = $(this).parents(".js-ajaxUploadFileVideo");
                var uploadFile = $(parent).find("input[type=file]")[0].files;

                if (uploadFile.length) {
                    for (var x = 0; x < uploadFile.length; x++) {
                        data.append("file", uploadFile[x]);
                    }

                    // console.log(uploadFile);
                    $.ajax({
                        type: "POST",
                        url: "/Common/UploadFileImage",
                        contentType: false,
                        processData: false,
                        data: data,
                        success: function (respone) {
                            if (respone != null) {
                                if (respone.data != '') {
                                    filenameVideo = respone.data;
                                    console.log(respone.data);
                                }
                            }
                            swal("Upload hình ảnh thành công");
                        },
                        error: function () {
                            swal("Upload hình ảnh lỗi");
                        }
                    });
                } else {
                    swal("Bạn chưa chọn file", "", "error");
                }

            });

            function AjaxbtnSaveNewsPost() {
                // var name = [];
                //$('#CategoryId input: checked').each(function() {
                //    name.push(this.CategoryId);
                //});
                if (checkInput().result) {
                    var formData = new FormData($('#m_form')[0]);
                    // var checkboxValString = getCheckBoxVar().join(",");

                    formData.append("LinkImage", filenameVideo);

                    // formData.append("IsPublished", checkboxValString);
                    //var date = $("input[name=CreatedOn]").val();
                    //formData.append("CreatedOn", date);

                    $.ajax({
                        url: '/News/NewsPost',
                        type: 'POST',
                        data: formData, // serializes the form's elements.
                        contentType: false,
                        processData: false,
                        success: function (response) {
                            if (response.result) {
                                swal("", response.message, "success");
                                //setTimeout(function () {
                                //    location.reload();
                                //},
                                //    5000);
                            } else {
                                swal("", response.message, "warning");

                            }
                            //setTimeout(function () {

                            //    location.reload();

                            //    //End
                            //},
                            //    5000);

                        },
                        error: function (error) {
                            alert("Đã bị lỗi");
                        }
                    });
                }
            }

            //var edit = function () {
            //    $('.click2edit').summernote({ focus: true });
            //};

            //var save = function () {
            //    //AjaxbtnSaveNewsPost();
            //    var markup = $('.click2edit').summernote('code');
            //    $('.click2edit').summernote('destroy');
            //};

            $("#save").on("click", AjaxbtnSaveNewsPost);
        });
        function checkInput() {
            //== Base elements
            var formEl = $('#m_form');
            var validator;
            validator = formEl.validate({
                //== Validate only visible fields
                ignore: ":hidden",

                //== Validation rules
                rules: {
                    //=== Client Information(step 1)
                    //== Client details
                    name: {
                        required: true
                    },
                    linkimage: {
                        required: true
                    },

                    category: {
                        required: true
                    }

                },

                //== Validation messages
                messages: {
                    'account_communication[]': {
                        required: 'You must select at least one communication option'
                    },
                    accept: {
                        required: "You must accept the Terms and Conditions agreement!"
                    }
                },

                //== Display error
                invalidHandler: function (event, validator) {


                    swal({
                        "title": "",
                        "text": "Có lỗi xãy ra, Vui lòng bổ sung lại thông tin",
                        "type": "error",
                        "confirmButtonClass": "btn btn-secondary m-btn m-btn--wide"
                    });
                },

                //== Submit valid form
                submitHandler: function (form) {

                }
            });
            return {
                result: validator.form()
            };
        };
<<<<<<< HEAD
        $('#summernote-title').summernote();

        $('.summernote').summernote({
            callbacks: {
                onImageUpload: function (files) {
                    if (!files.length) return;
                    var file = files[0];
                    // create FileReader
                    var reader = new FileReader();
                    reader.onloadend = function () {
                        // when loaded file, img's src set datauri
                        console.log("img", $("<img>"));
                        var img = $("<img>").attr({ src: reader.result, width: "100%" }); // << Add here img attributes !
                        console.log("var img", img);
                        $("#summernoteContent").summernote("insertNode", img[0]);
                    }

                    if (file) {
                        // convert fileObject to datauri
                        reader.readAsDataURL(file);
                    }
                }
            }
        });
=======

        //$('.summernote').summernote();
        //$('.summernote').summernote({
        //    callbacks: {
        //        onImageUpload: function (files) {
        //            if (!files.length) return;
        //            var file = files[0];
        //            // create FileReader
        //            var reader = new FileReader();
        //            reader.onloadend = function () {
        //                // when loaded file, img's src set datauri
        //                console.log("img", $("<img>"));
        //                var img = $("<img>").attr({ src: reader.result, width: "100%" }); // << Add here img attributes !
        //                console.log("var img", img);
        //                $('.summernote').summernote("insertNode", img[0]);
        //            }

        //            if (file) {
        //                // convert fileObject to datauri
        //                reader.readAsDataURL(file);
        //            }
        //        }
        //    }
        //});
>>>>>>> master/CSDev
    </script>
}

